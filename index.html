<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BabeLinux</title>
<link rel="icon" href="data:image/png;base64,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">
<style>
:root {
--terminal-color: #33FF33;
}
html, body {
margin: 0; padding: 0; background-color: #000; color: var(--terminal-color);
font-family: 'Menlo', 'Monaco', 'Courier New', monospace; font-size: 16px;
overflow: hidden; width: 100%; height: 100%;
}
body { display: flex; align-items: center; justify-content: center; width: 100vw; height: 100vh; }
#terminal-frame {
width: 100%; height: 99.8%; box-sizing: border-box; border: 1px solid var(--terminal-color);
display: flex; flex-direction: column;
}
#tabs-container { display: flex; background-color: #0a0a0a; border-bottom: 1px solid var(--terminal-color); flex-shrink: 0; }
.tab {
padding: 8px 15px; cursor: pointer; border-right: 1px solid var(--terminal-color);
position: relative; display: flex; align-items: center; gap: 8px;
}
.tab:hover { background-color: #1a1a1a; }
.tab.active { background-color: #111; color: #55FF55; font-weight: bold; }
.tab-close { font-weight: normal; padding: 0 4px; border-radius: 3px; }
.tab-close:hover { background-color: #FF3333; color: #000; }
.new-tab-button { padding: 8px 15px; cursor: pointer; font-weight: bold; }
.new-tab-button:hover { background-color: var(--terminal-color); color: #000; }
#terminal-windows-container { flex-grow: 1; position: relative; overflow: hidden; }
.terminal {
padding: 15px; white-space: pre-wrap; word-wrap: break-word; height: 100%; width: 100%;
box-sizing: border-box; overflow-y: auto; cursor: text; outline: none; position: absolute; top: 0; left: 0;
}
.terminal-image { max-width: 95%; margin-top: 10px; margin-bottom: 10px; border: 2px solid var(--terminal-color); }
.prompt-line { display: flex; white-space: pre; }
.cursor {
background-color: currentColor;
display: inline-block; width: 9.6px; height: 19px; animation: blink 1s step-end infinite; margin-left: 1px;
}
@keyframes blink { 50% { background-color: transparent; } }
#file-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 5px 15px; padding-left: 20px; }
.folder { color: #00aaff; font-weight: bold; }
.terminal-video {
max-width: 80%; max-height: 70%; display: block; margin: 15px 0;
border: 2px solid var(--terminal-color); outline: none;
}
#tab-group { display: flex; flex-grow: 1; }
#nano-editor {
display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
background-color: #000; z-index: 100; flex-direction: column;
font-family: 'Menlo', 'Monaco', 'Courier New', monospace;
}
#nano-textarea {
flex-grow: 1; background-color: #000; color: var(--terminal-color);
border: none; outline: none; padding: 10px; font-size: 16px; resize: none;
}
#nano-footer { flex-shrink: 0; padding: 2px 5px; text-align: center; background-color: #0a0a0a; }
.nano-command { background-color: #0a0a0a; color: var(--terminal-color); padding: 2px 5px; margin: 0 10px; display: inline-block; }

.terminal.theme-amber { color: #FFBF00; }
.terminal.theme-sky { color: #87CEEB; }
.terminal.theme-rose { color: #FFC0CB; }
</style>
</head>
<body>
<div id="terminal-frame">
<div id="tabs-container">
<div id="tab-group"></div>
</div>
<div id="terminal-windows-container"></div>
</div>

<div id="nano-editor">
<textarea id="nano-textarea"></textarea>
<div id="nano-footer">
<span class="nano-command">^R Read File</span>
<span class="nano-command">^O Save</span>
<span class="nano-command">^X Exit</span>
</div>
</div>

<input type="file" id="nano-file-input" style="display: none;" accept=".txt, text/plain">
<input type="file" id="pic-file-input" style="display: none;" accept="image/*">
<input type="file" id="media-file-input" style="display: none;" accept="audio/*,video/*">
<audio id="audio-player"></audio>

<script>
const config = {
maxTabs: 5,
hostname: 'babelinux',
defaultUsername: 'guest',
defaultColor: '#33FF33',
asciiWidth: 80,
apps: {
'tetris': 'https://morepcfun.github.io/tetris/'
}
};

const text = {
welcome: "Hey, cutie! What's your name?",
bootingOS: "Starting BabeLinux...",
authenticating: "Authenticating user... OK\n",
systemCheck: "System check... OK\n",
connecting: "Connecting to network... OK\n",
helpHint: "For a list of available commands, type 'help'.\n",
commandNotFound: "Command not found:",
secretResponse: "Oh, you found my secret command..."
};

const introText = `AVAILABLE COMMANDS:

play             - Play a local media file
pause            - Pause playback
stop             - Stop playback
clear, cls       - Clear the screen
date             - Show date and time
history          - Show command history
theme [color]    - Change color theme (e.g., amber, sky, rose)
nano [filename]  - Open a simple text editor
pic              - Simple image editor
say [text]       - Make the terminal speak
tetris           - Opens a game of Tetris
help             - Show this help message

TAB COMMANDS:

Alt + T          - New tab
Alt + X          - Close active tab`;

const state = {
tabs: [],
activeTabId: null,
nextTabId: 1,
audioCtx: null,
username: '',
awaitingUsername: true,
isNanoMode: false,
nanoFilename: '',
currentAudioTabId: null
};

const terminalFrame = document.getElementById('terminal-frame');
const tabsContainer = document.getElementById('tabs-container');
const terminalWindowsContainer = document.getElementById('terminal-windows-container');
const audioPlayer = document.getElementById('audio-player');
const nanoEditor = document.getElementById('nano-editor');
const nanoTextarea = document.getElementById('nano-textarea');
const nanoFileInput = document.getElementById('nano-file-input');
const picFileInput = document.getElementById('pic-file-input');
const mediaFileInput = document.getElementById('media-file-input');

const delay = ms => new Promise(res => setTimeout(res, ms));

function getActiveTab() {
return state.tabs.find(t => t.id === state.activeTabId);
}

function appendToTerminal(tab, htmlContent) {
if (tab && tab.terminalElement) {
tab.terminalElement.insertAdjacentHTML('beforeend', htmlContent);
tab.terminalElement.scrollTop = tab.terminalElement.scrollHeight;
}
}

function createPrompt(tab, subPrompt = '') {
if (!tab) return;
const oldCursor = tab.terminalElement.querySelector('.cursor');
if (oldCursor) oldCursor.remove();

let promptText;
if (subPrompt) {
promptText = subPrompt;
} else if (tab.isPicMode) {
promptText = 'pic>';
} else {
promptText = `${state.username}@${config.hostname}:~$`;
}

const promptHTML = `<div class="prompt-line"><span>${promptText} </span><span class="active-command-text"></span><span class="cursor"></span></div>`;
appendToTerminal(tab, promptHTML);
tab.currentCommand = '';
}

function refocusTerminal(tab) {
if (!tab) return;
requestAnimationFrame(() => {
tab.terminalElement.focus();
tab.terminalElement.scrollTop = tab.terminalElement.scrollHeight;
});
}

function initAudio() {
if (!state.audioCtx) {
try {
state.audioCtx = new(window.AudioContext || window.webkitAudioContext)();
} catch (e) { console.error("Web Audio API is not supported in this browser."); }
}
}

function playSound(type, freq, gainVal, duration) {
if (!state.audioCtx) return;
const oscillator = state.audioCtx.createOscillator();
const gainNode = state.audioCtx.createGain();
oscillator.connect(gainNode);
gainNode.connect(state.audioCtx.destination);

oscillator.type = type;
oscillator.frequency.setValueAtTime(freq, state.audioCtx.currentTime);
gainNode.gain.setValueAtTime(gainVal, state.audioCtx.currentTime);
gainNode.gain.exponentialRampToValueAtTime(0.00001, state.audioCtx.currentTime + duration);

oscillator.start(state.audioCtx.currentTime);
oscillator.stop(state.audioCtx.currentTime + duration);
}

function playKeySound() { playSound('sine', 600 + Math.random() * 200, 0.2, 0.08); }
function playReturnSound() { playSound('square', 440, 0.1, 0.05); }

function playClearSound() {
if (!state.audioCtx) return;
const sampleRate = state.audioCtx.sampleRate;
const buffer = state.audioCtx.createBuffer(1, sampleRate, sampleRate);
const output = buffer.getChannelData(0);
for (let i = 0; i < sampleRate; i++) { output[i] = Math.random() * 2 - 1; }
const noise = state.audioCtx.createBufferSource();
noise.buffer = buffer;
const gainNode = state.audioCtx.createGain();
gainNode.gain.setValueAtTime(0.2, state.audioCtx.currentTime);
gainNode.gain.exponentialRampToValueAtTime(0.001, state.audioCtx.currentTime + 0.15);
noise.connect(gainNode);
gainNode.connect(state.audioCtx.destination);
noise.start();
noise.stop(state.audioCtx.currentTime + 0.15);
}

function switchTab(tabId) {
if (state.isNanoMode || state.activeTabId === tabId) return;
state.activeTabId = tabId;
state.tabs.forEach(tab => {
const isActive = tab.id === tabId;
tab.tabElement.classList.toggle('active', isActive);
tab.terminalElement.style.display = isActive ? 'block' : 'none';
if (isActive) { refocusTerminal(tab); }
});
}

function updateNewTabButton() {
let newTabButton = tabsContainer.querySelector('.new-tab-button');
if (state.tabs.length < config.maxTabs) {
if (!newTabButton) {
newTabButton = document.createElement('div');
newTabButton.className = 'new-tab-button';
newTabButton.textContent = '+';
newTabButton.onclick = createNewTab;
tabsContainer.appendChild(newTabButton);
}
} else {
if (newTabButton) newTabButton.remove();
}
}

function closeTab(tabId) {
if (state.tabs.length <= 1) return;
const tabIndex = state.tabs.findIndex(t => t.id === tabId);
if (tabIndex === -1) return;

const tabToClose = state.tabs[tabIndex];
if (tabToClose.videoElement) {
URL.revokeObjectURL(tabToClose.videoElement.src);
tabToClose.videoElement.remove();
}
if (tabToClose.id === state.currentAudioTabId) {
audioPlayer.pause();
URL.revokeObjectURL(audioPlayer.src);
audioPlayer.removeAttribute('src');
state.currentAudioTabId = null;
}

tabToClose.tabElement.remove();
tabToClose.terminalElement.remove();
state.tabs.splice(tabIndex, 1);
updateNewTabButton();

if (state.activeTabId === tabId) {
const newActiveIndex = Math.max(0, tabIndex - 1);
switchTab(state.tabs[newActiveIndex].id);
}
}

function createNewTab() {
if (state.tabs.length >= config.maxTabs) return;

const tabId = `tab-${state.nextTabId++}`;
const tabEl = document.createElement('div');
tabEl.className = 'tab';
tabEl.dataset.tabId = tabId;
tabEl.innerHTML = `<span>Terminal ${state.tabs.length + 1}</span>`;

if (state.tabs.length > 0) {
const closeButton = document.createElement('span');
closeButton.className = 'tab-close';
closeButton.textContent = 'x';
closeButton.onclick = (e) => { e.stopPropagation(); closeTab(tabId); };
tabEl.appendChild(closeButton);
}

tabEl.onclick = () => switchTab(tabId);

const terminalEl = document.createElement('div');
terminalEl.className = 'terminal';
terminalEl.id = tabId;
terminalEl.tabIndex = -1;

const newTab = {
id: tabId, tabElement: tabEl, terminalElement: terminalEl,
commandHistory: [], historyIndex: -1, currentCommand: '',
isProcessing: false, videoElement: null, isPicMode: false,
picOriginalImageData: null, picActiveImageData: null, picNextAction: null
};

state.tabs.push(newTab);
document.getElementById('tab-group').appendChild(tabEl);
terminalWindowsContainer.appendChild(terminalEl);
updateNewTabButton();
switchTab(tabId);

if (state.tabs.length > 1) {
newTab.isProcessing = true;
createPrompt(newTab);
newTab.isProcessing = false;
refocusTerminal(newTab);
}
}

function startNano(filename) {
state.isNanoMode = true;
state.nanoFilename = filename || 'untitled.txt';
nanoTextarea.value = '';
nanoEditor.style.display = 'flex';
nanoTextarea.focus();
}

function closeNano() {
state.isNanoMode = false;
nanoTextarea.value = '';
state.nanoFilename = '';
nanoEditor.style.display = 'none';
const activeTab = getActiveTab();
if (activeTab) {
refocusTerminal(activeTab);
createPrompt(activeTab);
}
}

function saveNanoFile() {
const content = nanoTextarea.value;
const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
const url = URL.createObjectURL(blob);
const a = document.createElement('a');
a.href = url;
a.download = state.nanoFilename;
document.body.appendChild(a);
a.click();
document.body.removeChild(a);
URL.revokeObjectURL(url);
}

function readNanoFile() {
nanoFileInput.onchange = (e) => {
const file = e.target.files[0];
if (!file) return;
const reader = new FileReader();
reader.onload = (event) => {
nanoTextarea.value += event.target.result;
nanoTextarea.focus();
};
reader.readAsText(file);
e.target.value = '';
};
nanoFileInput.click();
}

function startPicMode(tab) {
let fileSelected = false;
// This listener handles the case where the user cancels the file selection dialog.
// It's a bit of a hack but works in most modern browsers.
const handleCancel = () => {
setTimeout(() => {
if (!fileSelected) {
createPrompt(tab);
refocusTerminal(tab);
}
}, 200);
};
window.addEventListener('focus', handleCancel, { once: true });

picFileInput.onchange = (e) => {
fileSelected = true;
window.removeEventListener('focus', handleCancel);

const file = e.target.files[0];
if (!file) {
createPrompt(tab);
return;
}
const reader = new FileReader();
reader.onload = (event) => {
tab.picOriginalImageData = event.target.result;
tab.picActiveImageData = event.target.result;
tab.isPicMode = true;
showImageAndMenu(tab, tab.picActiveImageData);
};
reader.readAsDataURL(file);
e.target.value = '';
};
picFileInput.value = '';
picFileInput.click();
}

function showImageAndMenu(tab, imageData) {
const image = document.createElement('img');
image.src = imageData;
image.className = 'terminal-image';
image.onload = () => { tab.terminalElement.scrollTop = tab.terminalElement.scrollHeight; };
const menu = document.createElement('span');
menu.textContent = "\n[1] Compress  [2] Resize  [3] Grayscale  [4] Sepia  |  [save] Save  [reset] Reset  [exit] Exit\n";
tab.terminalElement.appendChild(image);
tab.terminalElement.appendChild(menu);
createPrompt(tab);
}

async function applyCanvasFilter(imageData, filter, value) {
return new Promise(resolve => {
const image = new Image();
image.onload = () => {
const canvas = document.createElement('canvas');
let quality = 0.92;
if (filter === 'resize') {
const aspectRatio = image.height / image.width;
canvas.width = parseInt(value, 10);
canvas.height = canvas.width * aspectRatio;
} else {
canvas.width = image.width;
canvas.height = image.height;
}
const ctx = canvas.getContext('2d');
ctx.drawImage(image, 0, 0, canvas.width, canvas.height);
if (filter === 'grayscale' || filter === 'sepia') {
const pixelData = ctx.getImageData(0, 0, canvas.width, canvas.height);
const data = pixelData.data;
for (let i = 0; i < data.length; i += 4) {
const r = data[i], g = data[i + 1], b = data[i + 2];
if (filter === 'grayscale') {
const avg = (r + g + b) / 3;
data[i] = data[i + 1] = data[i + 2] = avg;
} else if (filter === 'sepia') {
data[i] = Math.min(255, r * 0.393 + g * 0.769 + b * 0.189);
data[i + 1] = Math.min(255, r * 0.349 + g * 0.686 + b * 0.168);
data[i + 2] = Math.min(255, r * 0.272 + g * 0.534 + b * 0.131);
}
}
ctx.putImageData(pixelData, 0, 0);
} else if (filter === 'compress') {
quality = parseInt(value, 10) / 100;
}
resolve(canvas.toDataURL('image/jpeg', quality));
};
image.src = imageData;
});
}

async function handlePicSubCommand(input, tab) {
const command = input.toLowerCase();
if (command === 'exit' || command === 'quit') {
await handlePicCommand('exit', tab);
return;
}

const lastPromptLine = tab.terminalElement.querySelector('.prompt-line:last-child');
if (lastPromptLine) {
const promptText = lastPromptLine.querySelector('span:first-child').textContent;
lastPromptLine.innerHTML = `<span>${promptText}</span><span>${input}</span>`;
}
const action = tab.picNextAction;
tab.picNextAction = null;
switch (action) {
case 'compress':
tab.picActiveImageData = await applyCanvasFilter(tab.picActiveImageData, 'compress', input);
break;
case 'resize':
tab.picActiveImageData = await applyCanvasFilter(tab.picActiveImageData, 'resize', input);
break;
}
showImageAndMenu(tab, tab.picActiveImageData);
}

async function handlePicCommand(command, tab) {
const lastPromptLine = tab.terminalElement.querySelector('.prompt-line:last-child');
if (lastPromptLine) {
lastPromptLine.innerHTML = `<span>pic> </span><span>${command}</span>`;
}
switch (command.toLowerCase()) {
case '1':
tab.picNextAction = 'compress';
createPrompt(tab, "Quality (1-100): ");
return;
case '2':
tab.picNextAction = 'resize';
createPrompt(tab, "New width (pixels): ");
return;
case '3':
tab.picActiveImageData = await applyCanvasFilter(tab.picActiveImageData, 'grayscale');
showImageAndMenu(tab, tab.picActiveImageData);
return;
case '4':
tab.picActiveImageData = await applyCanvasFilter(tab.picActiveImageData, 'sepia');
showImageAndMenu(tab, tab.picActiveImageData);
return;
case 'reset':
tab.picActiveImageData = tab.picOriginalImageData;
showImageAndMenu(tab, tab.picActiveImageData);
return;
case 'save':
appendToTerminal(tab, "<span>Saving image...</span>");
const a = document.createElement('a');
a.href = tab.picActiveImageData;
a.download = 'edited-image.jpg';
a.click();
break;
case 'exit':
case 'quit':
tab.isPicMode = false;
tab.picOriginalImageData = null;
tab.picActiveImageData = null;
tab.picNextAction = null;
appendToTerminal(tab, "<span>Leaving image editor...</span>");
break;
default:
appendToTerminal(tab, "<span>Unknown pic command.</span>");
break;
}
createPrompt(tab);
}

function startPlayMode(tab) {
let fileSelected = false;
const handleCancel = () => {
setTimeout(() => {
if (!fileSelected) {
createPrompt(tab);
refocusTerminal(tab);
}
}, 200);
};
window.addEventListener('focus', handleCancel, { once: true });

mediaFileInput.onchange = (e) => {
fileSelected = true;
window.removeEventListener('focus', handleCancel);

const file = e.target.files[0];
if (!file) {
createPrompt(tab);
return;
}

if (state.currentAudioTabId && state.currentAudioTabId !== tab.id) { }
state.currentAudioTabId = tab.id;

if (audioPlayer.src) URL.revokeObjectURL(audioPlayer.src);

if (file.type.startsWith('audio/')) {
audioPlayer.src = URL.createObjectURL(file);
audioPlayer.play();
appendToTerminal(tab, `<span>Playing ${file.name}. Use 'pause' or 'stop'.</span>`);
} else if (file.type.startsWith('video/')) {
if (tab.videoElement) {
URL.revokeObjectURL(tab.videoElement.src);
tab.videoElement.remove();
}
appendToTerminal(tab, `<span>Now playing: ${file.name}</span>`);
const videoEl = document.createElement('video');
videoEl.className = 'terminal-video';
videoEl.src = URL.createObjectURL(file);
videoEl.controls = true;
videoEl.autoplay = true;

videoEl.addEventListener('pause', () => refocusTerminal(tab));
videoEl.addEventListener('play', () => refocusTerminal(tab));
videoEl.addEventListener('fullscreenchange', () => { if (!document.fullscreenElement) refocusTerminal(tab); });

videoEl.onended = () => {
URL.revokeObjectURL(videoEl.src);
videoEl.remove();
tab.videoElement = null;
refocusTerminal(tab);
};

tab.terminalElement.appendChild(videoEl);
tab.videoElement = videoEl;
} else {
appendToTerminal(tab, `<span>Error: File type of '${file.name}' is not supported.</span>`);
}
e.target.value = '';
createPrompt(tab);
refocusTerminal(tab);
};
mediaFileInput.value = '';
mediaFileInput.click();
}

const commandHandlers = {
'help': (tab) => {
appendToTerminal(tab, `<pre>${introText}</pre>`);
},
'cls': (tab) => {
playClearSound();
if (tab.videoElement) {
tab.videoElement.pause();
URL.revokeObjectURL(tab.videoElement.src);
tab.videoElement.remove();
tab.videoElement = null;
}
tab.terminalElement.innerHTML = '';
},
'clear': (tab) => commandHandlers.cls(tab),
'date': (tab) => {
appendToTerminal(tab, `<span>${new Date().toLocaleString('en-US')}</span>`);
},
'history': (tab) => {
const historyHTML = tab.commandHistory.map((item, i) => ` ${i + 1} ${item}`).join('\n');
appendToTerminal(tab, `<pre>${historyHTML}</pre>`);
},
'theme': (tab, arg) => {
const availableThemes = ['amber', 'sky', 'rose'];
tab.terminalElement.classList.remove(...availableThemes.map(t => `theme-${t}`));
if (arg === 'reset') {
appendToTerminal(tab, "<span>Color theme reset.</span>");
} else if (availableThemes.includes(arg)) {
tab.terminalElement.classList.add(`theme-${arg}`);
appendToTerminal(tab, `<span>Theme changed to ${arg}.</span>`);
} else {
appendToTerminal(tab, `<span>Usage: theme [color] or 'reset'. Available: ${availableThemes.join(', ')}</span>`);
}
},
'nano': (tab, arg) => startNano(arg),
'pic': (tab) => startPicMode(tab),
'say': (tab, arg) => {
if (!arg) { appendToTerminal(tab, "<span>Usage: say [text]</span>"); }
else if ('speechSynthesis' in window) {
const utterance = new SpeechSynthesisUtterance(arg);
window.speechSynthesis.speak(utterance);
} else { appendToTerminal(tab, "<span>Error: Text-to-speech not supported.</span>"); }
},
'play': (tab) => {
if (state.currentAudioTabId === tab.id && audioPlayer.src && audioPlayer.paused) {
audioPlayer.play();
appendToTerminal(tab, "<span>Resuming audio...</span>");
createPrompt(tab);
} else {
startPlayMode(tab);
}
},
'pause': (tab) => {
if (state.currentAudioTabId !== tab.id) { appendToTerminal(tab, "<span>Error: This tab does not control the audio.</span>"); }
else if (!audioPlayer.paused && audioPlayer.src) { audioPlayer.pause(); appendToTerminal(tab, "<span>Audio paused.</span>"); }
else { appendToTerminal(tab, "<span>No audio is playing.</span>"); }
createPrompt(tab);
},
'stop': (tab) => {
if (state.currentAudioTabId !== tab.id) { appendToTerminal(tab, "<span>Error: This tab does not control the audio.</span>"); }
else if (audioPlayer.src) {
audioPlayer.pause();
audioPlayer.currentTime = 0;
URL.revokeObjectURL(audioPlayer.src);
audioPlayer.removeAttribute('src');
state.currentAudioTabId = null;
appendToTerminal(tab, "<span>Audio stopped.</span>");
} else { appendToTerminal(tab, "<span>No audio is playing.</span>"); }
createPrompt(tab);
},
'secret': (tab) => {
appendToTerminal(tab, `<span>${text.secretResponse}</span>`);
}
};

const commandList = [...Object.keys(commandHandlers), ...Object.keys(config.apps)];

async function handleCommand(tab, commandStr) {
const lastPromptLine = tab.terminalElement.querySelector('.prompt-line:last-child');
if (lastPromptLine) {
lastPromptLine.outerHTML = `<div class="prompt-line"><span>${state.username}@${config.hostname}:~$ </span><span>${commandStr}</span></div>`;
}

const [cmd, ...args] = commandStr.trim().split(' ').filter(Boolean);
if (!cmd) {
createPrompt(tab);
return;
}

const handler = commandHandlers[cmd.toLowerCase()];
const joinedArgs = args.join(' ');

if (['nano', 'pic', 'play'].includes(cmd.toLowerCase())) {
if (handler) handler(tab, joinedArgs);
return;
}

// The output from the handler will appear on the line immediately after the command.
if (handler) {
handler(tab, joinedArgs);
} else if (config.apps[cmd.toLowerCase()]) {
appendToTerminal(tab, `<span>Opening '${cmd}'...</span>`);
window.open(config.apps[cmd.toLowerCase()], '_blank');
} else {
appendToTerminal(tab, `<span>${text.commandNotFound} ${cmd}</span>`);
}

// The new prompt will appear on the line immediately after the output.
createPrompt(tab);
}

document.body.addEventListener('keydown', async (e) => {
const tab = getActiveTab();
if (state.isNanoMode) return;

if (e.altKey) {
if (e.key.toLowerCase() === 't' || e.key.toLowerCase() === 'x') { e.preventDefault(); }
if (e.key.toLowerCase() === 't') createNewTab();
else if (e.key.toLowerCase() === 'x' && state.activeTabId) closeTab(state.activeTabId);
return;
}

if (state.awaitingUsername) {
e.preventDefault();
const usernamePromptText = document.getElementById('username-prompt-text');
if (e.key === 'Enter') {
playReturnSound();
state.username = state.username.trim() || config.defaultUsername;
state.awaitingUsername = false;
initAudio();
await startBootSequence();
} else if (e.key === 'Backspace') {
state.username = state.username.slice(0, -1);
if (usernamePromptText) usernamePromptText.textContent = state.username;
} else if (e.key.length === 1 && !e.ctrlKey && !e.metaKey && !e.altKey) {
state.username += e.key;
if (usernamePromptText) usernamePromptText.textContent = state.username;
}
return;
}

if (!tab || tab.isProcessing) return;

if (document.activeElement === tab.terminalElement) {
e.preventDefault();
const commandTextEl = tab.terminalElement.querySelector('.prompt-line:last-child .active-command-text');
if (!commandTextEl) return;

tab.currentCommand = commandTextEl.textContent;

if (e.key === 'Enter') {
playReturnSound();
const commandToProcess = tab.currentCommand;
if (commandToProcess.trim() && !tab.isPicMode && !tab.picNextAction) {
tab.commandHistory.push(commandToProcess);
}
tab.historyIndex = tab.commandHistory.length;
tab.isProcessing = true;

if (tab.isPicMode) {
if (tab.picNextAction) { await handlePicSubCommand(commandToProcess, tab); }
else { await handlePicCommand(commandToProcess, tab); }
} else {
await handleCommand(tab, commandToProcess);
}
tab.isProcessing = false;
} else if (e.key === 'Backspace') {
tab.currentCommand = tab.currentCommand.slice(0, -1);
commandTextEl.textContent = tab.currentCommand;
playKeySound();
} else if (e.key === 'ArrowUp' && !tab.isPicMode) {
if (tab.historyIndex > 0) {
tab.historyIndex--;
tab.currentCommand = tab.commandHistory[tab.historyIndex];
commandTextEl.textContent = tab.currentCommand;
}
} else if (e.key === 'ArrowDown' && !tab.isPicMode) {
if (tab.historyIndex < tab.commandHistory.length) {
tab.historyIndex++;
tab.currentCommand = tab.historyIndex < tab.commandHistory.length ? tab.commandHistory[tab.historyIndex] : '';
commandTextEl.textContent = tab.currentCommand;
}
} else if (e.key === 'Tab') {
const fragment = tab.currentCommand.split(' ').pop().toLowerCase();
const matches = commandList.filter(cmd => cmd.startsWith(fragment));
if (matches.length === 1) {
tab.currentCommand = tab.currentCommand.substring(0, tab.currentCommand.lastIndexOf(fragment)) + matches[0] + ' ';
commandTextEl.textContent = tab.currentCommand;
} else if (matches.length > 1) {
const suggestionsHTML = `<pre>\n${matches.join('   ')}</pre>`;
commandTextEl.parentElement.insertAdjacentHTML('beforebegin', suggestionsHTML);
tab.terminalElement.scrollTop = tab.terminalElement.scrollHeight;
}
} else if (e.key.length === 1 && !e.ctrlKey && !e.metaKey && !e.altKey) {
tab.currentCommand += e.key;
commandTextEl.textContent = tab.currentCommand;
playKeySound();
}
}
});

nanoTextarea.addEventListener('keydown', (e) => {
if (!state.isNanoMode) return;
if (e.ctrlKey) {
const key = e.key.toLowerCase();
if (['x', 'o', 'r'].includes(key)) {
e.preventDefault();
if (key === 'x') closeNano();
else if (key === 'o') saveNanoFile();
else if (key === 'r') readNanoFile();
}
}
});

document.body.addEventListener('click', (e) => {
const tab = getActiveTab();
if (terminalFrame.contains(e.target) && !tabsContainer.contains(e.target) && tab) {
if (e.target.tagName.toLowerCase() !== 'video') {
refocusTerminal(tab);
}
}
});

async function typeText(tab, text, delayMs) {
for (let i = 0; i < text.length; i++) {
const char = text.charAt(i);
if (char !== '\n') playKeySound();
appendToTerminal(tab, `<span>${char === '\n' ? '<br>' : char}</span>`);
await delay(delayMs);
}
}

async function startBootSequence() {
const tab = getActiveTab();
tab.isProcessing = true;
tab.terminalElement.innerHTML = '';
const bootSequence = [
{ text: text.bootingOS, delay: 50 },
{ text: text.authenticating, delay: 40 },
{ text: text.systemCheck, delay: 30 },
{ text: text.connecting, delay: 40 },
{ text: `\n${text.helpHint}\n`, delay: 15 },
];
for (const line of bootSequence) {
await typeText(tab, line.text, line.delay);
}
tab.isProcessing = false;
createPrompt(tab);
refocusTerminal(tab);
}

function init() {
createNewTab();
const firstTab = getActiveTab();
const welcomeHTML = `<h1>BabeLinux 6.9</h1><div class="prompt-line"><span>${text.welcome} </span><span id="username-prompt-text"></span><span class="cursor"></span></div>
<pre style="font-family: 'Courier New', 'Consolas', monospace; font-size: 0.25rem; line-height: 0.80; white-space: pre; margin: 0;">
.............................................+*;+?+;%%%%?%%%%+;**%?++%%%%%%%%S*%?%*;**%S*++??+;?**++**++:;:::,;?%*;*??;.........................
............................................,++:*?+;%%%%?%%%%;;+*%*+;%%%%%%%%S+%?%+;+*%S?+;??+;?**++**:+*;+*?;:*%*;*?*;.........................
............................................,+;:**;+%%%??%%%?;;;*%++;%%%%%%%%%+%*?;;+?SS?+;?*;;?*++++*;;??*?S*,+?*;*?++.........................
............................................,;::*+;+%%%?%%%%?:;;+%;+;?%%%%%%%?+%+*:;+?SS?;:?*:;?*+;++*;;:%%??*,;?*;*?++.........................
............................................:;:;*+:*%%%?%%%%*:;:+%;;:?%%%%%%%*+?*+;++?SS?;:?+:;*++;;+*;;,;?***,,**;*?;+.........................
...........................................,;+:;*;:*%%%?%%%%*:;:+%:;:*%%%%%%%+++*;;++%SS*;;?;:;*++;;++;;,,*++;..+*;+?;+.........................
..........................................,:++,++;:?%%%?%%%?+:;:;%,;:*?%%%%%?++;*:;;*%SS*:;*:::*++;;++;;,,+;;:..:+;+*;;.........................
..........................................,,*;.++:,?%%%?%%%?+:;:;?,;:+*%%%%%*++:*:;;+%SS+:+*::;++;;;+++;,,:,,....;:*+;:.........................
...........................................:*,,++:,?%%%?%%??;;;:;?:;;;+%%%%%*;;;;:;;?SSS+:++,:;++;;;;:;:.;;:.....,:+;+,.........................
...........................................:+.,+;:,?%%%?%%?*;;;:;*:;;;;?%%%%+;,;:;;*%##S+;*+::;;*;::,::,.?;:.....,,+:;..........................
...........................................;;.,+;:;?%%%?%%?*;;;;;*:;;:;?%%%?+;,;:++*S##%++*;::;;*:,,::,..*,......,,;:;..........................
...........................................;,.:;+*+?%%%?%%?+;++;;+;;;;:*%%%?+:,+;++?SSS?++*:;;;;*,,;;...:*,......,,:::..........................
...........................................;,.,+?%+?%%%?%??+:;;::;;;+;:*%%%*+::++*+?%?*;;++:+;+;+,+?:.,,,?+:.....,:,;,..........................
..........................................,:,+%%%*;?%%%*%??+;+?++*++++;*%%%*+,;++*;;,....,,.:;;;::%*,,,::%;:...,.,,:;,..........................
..........................................::*%*++;;?%%%*%??+;*%+****+++*?%?+;:+++:.......,.,.:;+,*S;,,:::S;;,..,,.,:,...........................
..........................................:;%?++;;;*?%%*%%?;;*S*????**+*?%?+;:+;,........,.,.;:;;S*,,;;::%;;,..,,.,,:,..........................
.........................................,:+S?+;;;:*?%%*%%*;:;+;+++%*?+*?%*+:+*;;,.........,.+::+S+::;:,;%;;,,..,..,::..........................
.........................................::+S%*+;::+?%?*%?*:,....,,+?%**?%*+;+%**++:.......,,+::?%;:;;:,*?+:,,..,,..,:,.........................
........................................,,,+S%*++;:+?%?+%?*:,,......*S????*++?%%%S?;,.....,,:;::%?;;;;:,?*+,,,..,,,.,::.........................
........................................,,,+S%*+++;;*%?+%??;,:,,....;S?%??*;*%?S#%:,,,,,,,::+;:;S*;;;;:,?;;,,,...,,,,::,........................
.......................................,,,.*S%?*++;;*%?;%?*+,;?+....;S%%??*+?S%##S:,,,,,,,:;+;:;%;;+;:,:+;;.,,...,:,,::,........................
......................................,:,.,*S%?**++:*%?;%?*+:**:,.,,:SS%??**%SS##S+;,::::++*+*:;%::;;:,;;+;.,,...,:::::,........................
......................................,:;.,*S%?**+;:+%?;?%*+;++,,,,,:%#S%?*?S#####%*+;;;+??*+?,:*,,::,,?+:;,,....,::::,.........................
.....................................,,:*,,?S%?**++;+%*;?%?+;+?::,,,;?#S%??S######S%%???%S%**?,,+,,::,;+::;,,....,,,,...........................
....................................,,::*.,?%??***+;;%*;?%?*+;%*;::;+?#S%?S#######S?*???*%?*?+..:..,::?*;++,,...................................
....................................,.;;:..*?*****++:?*;*%?*;;?S??+??S##%?S#####SSSS%???%%*??:,....,,*?*,++,......,,............................
...................................,.,::..:::::;**++:?*;*%?*+:+SS%SS%?##%%#####SSSSS%%%%%?**?:;.....;%?;.;+,....:,,,............................
...................................,.:,.,+++++;::;;+:*+;?%%++:,?S%++*SS#S######SSS%%%%%%%*??+*:...,+??+,,;+.....,.,.............................
..................................,..:..:::::;;+;::+:*+;??%++;,+%SSS%SSS#######SSSSS%%%%?%*?;*,,..,***:,,,,.....,...............................
.................................,,..,,:::::::,:;;:::++;??%++;,+*%%%%%SSS#######SSSSSSSS%?***;:;....,,,,,.......................................
.................................,..,,,:::::,,,,,::,,;;;?*%+;;::?%%%%SSS#########SSSSSSS%+*+?:;;:....:;:.......,................................
................................,,..,,;;::::,,,..,::,;;;?*%+:;:,*SSSSSSS###SSSS###SSSSS%*++?*:;;;,..,:::.......,,...............................
................................,...,;+++;:,,,.....:;::;?+?+,::.:%SSSS####%?%%%S#####SS*;++?;:;;:,,.:;;:,....,,,,,..............................
...............................,,...,:::;++:,,.....,+::;?+*+,,:,.:?S######?*???%####S%*;;+??:;;;:,,,;;;:,....,,,:,..............................
...............................,,..,,,...,;+;,.....,+::;?+*+:.:,..,;*S####SSSSSS###S%+;;+*%*:;+:,,,,+;+:,....,::::,.............................
...............................,..,,,......:;:,.....+,:;?+++:.,,...,++*%##########S?++++;?%;:+;:,,,:+;+;,....,::::,.............................
...............................,..,,,.......:;:.....+,:+?;;+:..,..+%%*+;+%S#####S%*++++;+%?:;*;,,,.;+;+;,.....:::,,.............................
...............................,,,,,....,,...:;,....+,:+?;;+,...,?##S?*;,:*%S#S?*+++++;;*%*:**:.,,,+++;;,.....::,...............................
...............................,,,,,,,,,,:,..,;,....+.:*?;:;,...:S###%*;:;****+**+++++;+?%;:?;,.,,:+;*;;,.....,,................................
...............................,,,,,,:::::,...;:...,;.,?*;,;,.....,+#S?;:+********+++;;+??:+?:..,.;*+*;;,.....,,................................
..............................,,,,,,::::::,...::...:;.,%+:,:,.......:%*::*********++;;+*%+:?+:..,.;++*;:,......,................................
.............................,,,,,,,,::::,....::...:,.:%+:,:,,,......;*,;*********+++++*?;;?:,..,,++**;:........................................
.............................,,,,,,,,,:,,.....::...:.,+%;:,:,...,..,:,;,;*********+++;;**:*?,...,:++?+;,,....,..................................
............................,,,,,,,,,,,,......::...:..*?:,,,..,,.,:::,:,;*********++:,;*+:?+.....:++?;:;:...:,..................................
...........................,,,,,,,,,,,.......,;,...,..?+:,,,,,.,:;,:;:;,:********+;,.,+*;+?:.....;+*?;:*:.,:;,..................................
..........................,,,,,,,,,,,........,:......,%;:,,,.,:;;;:;S*+,,+******+;,.:+**;*?,,...,;+?*:++::;+:...................................
..........................,,,,,,,,,..................;?::.,,:;;+++;,?*+:.;***+;:;::,:++*:?+:,...:++?+:*;::;;,...................................
.........................,,,,,,,,,...................**::::;++***++:+**;,;++;:,,;;,,:;++;?:,....:;+?;+*;::;:....................................
....................,...,,,,,,,,,.................;**%:;***??****??;:?%;;:,,..:+*+,:;++;;?,....,::**;*;::;::....................................
...................,,..,,,,,,,,................,;?S#%?:+%??%???????+,?%;+*:.,;+*SS;:;++:+*.....,,:*+++:::;;,....................................
..................,,...,,,,,,,................;%####%;:?S%SS%%?????+,??;*?:,+?*S#?:,:+;:+;.....,.:*;;;:::;::....................................
..................,,..,,,,,,,...............,?#####S?,*##SSS%%?????;:**+;;,+S?S?:,:;;+;:+:.....;.;*;:::,;+,:....................................
.................,,,,,,,,,,............,...;S######%:;#####S%%?????;:*:,.,;**%+,:;;+;;;:+,....:,,++:::,:+:,:....................................
.................,,,,,,,,,............,...+####S##S*:#####SS%%????*;;;,..:***:,+**+*+;::+,...,,.,+;,::,:+,,:....................................
................,,,,,,,,,.....,......,...*####S###?;######SS%%????+;:+;.,++;,;*??****;:,;,..,,.,,;:,:,,;;.,:....................................
................,,,,,,,,....,,......,...+###SS###%+S######SS%%????;::*;,;;:,+*????***;:,;,..,.,,,;:,:,,+,..:....................................
................,,,,,,,....,,......,...+###S#####?S#######SS%%???*:,:::,:,:+???????**+;,:,..,::,,:,:,,,+...,....................................
...............,,,,,,,...,,,......,..,+S##S#####SS#######SS%%???*;,::::::+*?%%%%%%?***+,,,.,,::,,,,,.,::...,....................................
...............,,,,,...,,,..........,;%##S##############SSS%%???+::;;::;+*?%%%SSS%%?*?+,,,.,,::.,:,,..:,........................................
...............,,,...,,,,..........,:*SS%S#############SSS%%???*;++*+,:+*?%SSSSSSSS?*%+:,,.:,:,.:;,..,:,........................................
...............,....,,,............:+%S%S#############SSS%%%??*++?*;,,+*%S########S??%+;,,.,,:,.:;,.,,:,........................................
...............,..................,+*%%%SS###########SSS%%%??*+;+;;,.;*%##########S%%%*+:,.,,:,.:;,,,,,....,....................................
.................................,;*?%?%SSSS######SSSSS%%%???*+;::,.,*%###########SSS%?**:.,.,,,:;,,,:,....,....................................
................................,,+*?%?%%SSSSSSSSSSSSS%%%???+++:,:..;%####@@########S%%??+,,...,,;,,,,....,,....................................
...............................,,;*+???%%%SSSSSSSSSS%%%????+:;++:..,?S####@@@#######S%%%%?:...,.,:,::,...,.,....................................
..............................,:,+*:*???%%%%%%S%%%%%%%???*+:,;**,..+S####@@@@#######S%SS%%;...,.:,,:::,.,:.,,...................................
.............................,:,:*;:*????%%%%%%%%%%%????*+::::*+..:%###@@@@@@@######SSSS%?*....,:,,::::,:,.,,...................................
.........................,...;,,;+:,*?????????%%???????*+::::,:,,.*S###@@@@@#########SSS%%%,.,.,:::::::::...:...................................
........................,...::,:;::,;????????????????**+::::,..,,:%####@@@@@@########SSS%%%:...::::::::::...:...................................
.......................,...:+:,:;:,.,*?????????????***+::::,....:*S###@@@@@@@########SSS%%?+..,:::::::::,,..:...................................
.....................,,....+;,,:::...;%???????????****+:,,.....,+?S##@@@@@@@@########SSS%%?*..,:::::::::..,,:...................................
....................:,....;+:,,:,,..,,?%????????????*+*,.....,,;*?#####@@@@@#########SSS%%??..,,::,,:::,...,:...................................
...................::....,*::.,,,.,,..:%%???????????++;....,:::+*%###################SSS%%??..,,:,,,::,.....:...................................
..................;;,....++:,.,,,,:....;%%????***??*::,...::::;+*?S##################SSS%%??...,,,,,::......;...................................
.................;+:....:*::...,,:,.....;%%%%??**+++,.,:.,:,,:++**%#################SSSS%%??...,,.,,,,.....,;...................................
................:*;.....++,:..,::,.......;?%%%%%??*;..;;,.,..:;++*?%S###############SSS%%???.......,,......,;...................................
...............,?+.....:*;,,..:;,........:;+?SS%%%?*,,:;,...,+++**?%SS#############SS%S%%???.......,.......,+...................................
...............+?:.....++::,.,;:,........;;;;;*%%%%?:..,....:*??????%SSS##########SS%%%%???*.......,.......,+...................................
..............,?+.....,*;::..::,........,;;;;;;;;;;;,..,::.,;*??????%%SSSS######SSSS%%%????+...............:;...................................
..............;?:.....;*;,:,::,.........:;;;;;;;;;;;...,;:,;+;+??????%%%SSSSSSSSSSS%%%%???%:......,.....,..;;...................................
..............+*......+*;.,,:,..........:+?+;;;;;;;;,...:,,:+?*+*?????%%%%SSSSSS%%%%??????%.............,..+:...................................
..............*+......*+;;,:,..,,.......;?#S%*;;;;;;,..,::,:;+??????????%%%%%%%%%%???????%*......,......,..*:...................................
..............+;.....:*;++,,..,,,......,+%###S?+++++;,;+;:.,:;+????????????%%%%%???*?????%:.....,......,,.,?,...................................
..............::.....;*+++,..::,......:;*#####S%**????%%*,,;;;;+*?????????????????***???%*.....,,......,,.:?....................................
...............,.....;;;;+,.,:,.......+;?#######%*???%S#%:+S*;;;;*?????**??????******????:.....,,......,,.;*....................................
.....................:,::;;,:,........*;*########S?????%?,*#S?+++;+*???**************???;.....,,,......:,.*+....................................
....................,,..:;;:,.........*++#########S%????*,*##S*+++;;*???************??%+......:,,......:..?:....................................
...................,:...,:;:..........**+###########%???+,+S##S*+++;;*????*********???+,.....,:,,......:.:*.....................................
..................,:.....,::,........,*%+S###########S%?;,+?%##S*+++;;+?%????***???%?;,.....,::,.......:.*;.....................................
.................,:.......,::........:+S*%#############%:,*???S#S?+++;;;+???????%%*;,.......:::,......,;,*,.....................................
................::.........,,........;*?%?###########S#?,;??**?%S#%*++;;;;;+***+;,.........,::,.......,;;;......................................
...............,;...................,;?*S%###########?+;:?#%???%#SSS?+;;;;;;;;;;...........:::........,;+,......................................
</pre>
`;

firstTab.terminalElement.innerHTML = welcomeHTML;
firstTab.isProcessing = false;
refocusTerminal(firstTab);
}

init();
</script>
</body>
</html>